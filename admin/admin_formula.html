<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>导师双向选择系统</title>
    <link href="../lib/bootstrap.min.css" rel="stylesheet">

    <style>
        h1{
            margin: 20px 50px 10px 20px;
        }
        #pname{
            margin-top:25px;
            margin-right: 50px;
            font-size: 18px;
        }
        #pbtn{
            margin-top:10px;
            margin-right: 10px;
        }
        #nav_font{
            font-size: 17px;
            font-weight:600;
        }
        html {
            position: relative;
            min-height: 100%;
        }

        body {
            margin-bottom: 60px;
        }

        .footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            background-color: #f5f5f5;
        }

        #hx{
            height: 1px;
            background-color: black;
            margin: 20px 0 auto;
        }

        .split{
            height: 2px;
            background-color: black;
            margin: 20px 20px auto;
        }
    </style>

</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="navbar-header">
            <h1>导师双向选择系统</h1>
        </div>
        
        <div class="navbar-right" id="pbtn">
            <input type="button" class="btn btn-default" value="退出" id="pbtn">
        </div>

        <div class="navbar-right" id="pname">
            <p id="uName" style="font-size:18px"></p>
            <form id="nameForm">
                <input type="hidden" name="uid" id="uUid">
            </form>
        </div>
  
    </nav>
    <div class="container">
        <nav class="navbar navbar-default" role="navigation">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand">选项</a>
                </div>
                <div id="nav_font">
                    <ul class=" nav navbar-nav" id="mytab">
                    
                        <li ><a href="javascript:;" class="jump" var="toIndex">首页</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                查看信息
                                <span class=" caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="javascript:;" class="jump" var="toStuInfo">学生信息</a></li>
                                <li class="divider"></li> 
                                <li><a href="javascript:;" class="jump" var="toTeaInfo">导师信息</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                双向选择
                                <span class=" caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu">
                                <li> <a href="javascript:;" class="jump" var="toFirst"> 第一轮</a></li>
                                <li class="divider"></li>
                                <li> <a href="javascript:;" class="jump" var="toSecond"> 第二轮</a></li>
                                <li class="divider"></li>
                                <li> <a href="javascript:;" class="jump" var="toThird"> 管理员分配</a></li>
                                <li class="divider"></li>
                                <li> <a href="javascript:;" class="jump" var="toConfirm"> 导师确认</a></li>
                            </ul>
                        </li>

                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                时间确认
                                <span class=" caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu">
                                <li> <a href="javascript:;" class="jump" var="toFormula">时间设置</a></li>
                                <li class="divider"></li>
                                <li data-toggle="modal" data-target="#publish"> <a href="#">结果公布</a></li>
                            </ul>
                        </li>
                        <li data-toggle="modal" data-target="#myModal"> <a href="#"> 修改密码</a></li>

                    </ul>
                </div>
            </div>   
        </nav>
    </div>

    <div class="modal fade" id="publish" tabindex="-1" role="form" aria-labelledby="publish">
        <div class=" modal-dialog">
            <div class=" modal-content">
                <div class=" header" style="background-color: #4682B4;height: 50px;">
                    <button type="button" class="close btn-warning" data-dismiss="modal" aria-hidden="true" style="color: white;">
                        &times;
                    </button>
                    <label style="font-size: 22px;margin: 10px 10px auto;color: white;">确认提交</label>
                </div>
                <div class="modal-body">
                    <form id="publishform">
                        <div class=" form-group">
                            <p class="alert alert-danger" style="font-size: 18px;">在公示期结束之后，确认所有的信息没有错误，再点击提交<br>并且一般情况下不再修改</p>
                        </div>
                        <input type="button" id="publishBtn" class="btn btn-primary col-md-offset-10" value="提交确认">
                    </form>
                </div>
            </div>
        </div>
    </div>
 



    <div class="modal fade" id="myModal" tabindex="-1" role="form" aria-labelledby="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="header" style="background-color: #4682B4;height: 50px;">
                    <button type="button" class="close btn-warning" data-dismiss="modal" aria-hidden="true" style="color: white;">
                        &times;
                    </button>
                    <h2 class="modal-title text-center" id="myModalLabel" style="color: white;">
                        修改密码
                    </h2>
                </div>
                <div class="modal-body">
                    <form id="updateform">
                        <div class=" form-group">
                            <label for="prepass" class=" control-label">旧密码：</label>
                            <input type="password" class=" form-control" id="prepass" name="prepass">
                        </div>
                        <div class=" form-group">
                            <label for="newpass" class=" control-label">新密码：</label>
                            <input type="password" class=" form-control" id="newpass" name="newpass">
                        </div>
                        <div class=" form-group">
                            <label for="repeatpass" class=" control-label">重复密码：</label>
                            <input type="password" class=" form-control" id="repeatpass" name="repeatpass">
                        </div>
                        <div class="row">
                            <span id="returnMessage" class="glyphicon col-lg-6 text-danger"></span>
                            <button type="button" class="btn btn-default right col-lg-offset-3" data-dismiss="modal">关闭</button>
                            <button id="submitBtn" type="button" class="btn btn-primary">修改</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <br>

    <div class="container">

        <div class="row col-lg-offset-4">
            <form id="setFirst">
                <div class=" form-group">
                    <label style="font-size: 22px;" class=" col-md-offset-2">设置第一轮：</label>
                </div><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">开始时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="firstStart">
                </div><br><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">结束时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="firstEnd">
                </div><br>
                <div class=" form-group">
                    <input type="button" class="btn btn-primary col-md-offset-5 subTime" value="发布" style="width: 80px;" var="subFirst">
                </div>
            </form>
        </div>

        <div class="split"></div><br>

        <div class="row col-lg-offset-4">
            <form id="setSecond">
                <div class=" form-group">
                    <label style="font-size: 22px;" class=" col-md-offset-2">设置第二轮：</label>
                </div><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">开始时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="secondStart">
                </div><br><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">结束时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="secondEnd">
                </div><br><br>
                <div class=" form-group">
                    <input type="button" class="btn btn-primary col-md-offset-5 subTime" value="发布" style="width: 80px;" var="subSecond">
                </div>
            </form>
        </div>

        <div class="split"></div><br>

        <div class="row col-lg-offset-4">
            <form id="setFormula">
                <div class=" form-group">
                    <label style="font-size: 22px;" class=" col-md-offset-2">设置公示期：</label>
                </div><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">开始时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="formulaStart">
                </div><br><br>
                <div class=" form-group row">
                    <label style="font-size: 18px;" class="col-md-2">结束时间：</label>
                    <input type="date" class=" form-control col-md-8 datetimepicker" style="width: 200px;" id="formulaEnd">
                </div><br><br>
                <div class=" form-group">
                    <input type="button" class="btn btn-primary col-md-offset-5 subTime" value="发布" style="width: 80px;" var="subFormula">
                </div>
            </form>
        </div>

        
    </div>


    <footer style="background-color:#4682B4; height: 40px;" class="footer">
        <span>
            <p class=" text-center" style="color: white;font-size: 17px;margin-top: 5px;">Copyright &nbsp;&copy; 2020</p>
        </span>
    </footer>


    <script type="text/javascript" src="../lib/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../lib/bootstrap.min.js"></script>

    <script>
        $(document).ready(function(){

            function oneValues(){
        		var result;
        		var url=window.location.search; //获取url中"?"符后的字串  
        		if(url.indexOf("?")!=-1){
        			result = url.substr(url.indexOf("=")+1);
        		}
        		return result;
        	}
        	
            $("#uName").html(oneValues());
            $("#uUid").val(oneValues());

            $.ajax({
                type : "POST",
                url : "../AdminServlet/time",       //获取时间的url
                dataType : "json",
                async : false,
                success : function(res){
                    console.log(res);
                    if(res.oneStart!=0){
                        $("#firstStart").val(res.oneStart);
                        $("#firstEnd").val(res.oneEnd);
                    }
                    if(res.secondStart!=0){
                        $("#secondStart").val(res.twoStart);
                        $("#secondEnd").val(res.twoEnd);
                    }
                    if(res.threeStart!=0){
                        $("#formulaStart").val(res.threeStart);
                        $("#formulaEnd").val(res.threeEnd);
                    }                    
                }
            })

            $(".jump").on("click",function(){
                var diff =$(this).attr("var");
                if(diff == "toIndex"){
                    $(this).attr("href","admin_index.html"+"?numbers="+oneValues());
                }
                else if(diff == "toStuInfo"){
                    $(this).attr("href","admin_info_student.html"+"?numbers="+oneValues());
                }
                else if(diff == "toTeaInfo"){
                    $(this).attr("href","admin_info_teacher.html"+"?numbers="+oneValues());
                }
                else if(diff == "toFirst"){
                    $(this).attr("href","admin_choose_first.html"+"?numbers="+oneValues());
                }
                else if(diff == "toFormula"){
                    $(this).attr("href","admin_formula.html"+"?numbers="+oneValues());
                }
                else if(diff == "toSecond"){
                    $(this).attr("href","admin_choose_second.html"+"?numbers="+oneValues());
                }
                else if(diff == "toThird"){
                    $(this).attr("href","admin_choose_third.html"+"?numbers="+oneValues());
                }
                else if(diff == "toConfirm"){
                    $(this).attr("href","admin_choose_confirm.html"+"?numbers="+oneValues());
                }
            })

            $(".subTime").on("click",function(){
            	var stime =$(this).attr("var");
            	var subUrl="";
            	var time="";
            	if(stime=="subFirst"){
            		subUrl="../AdminServlet/SaveOne";
            		time={
            			"StartTime":$("#firstStart").val(),
            			"EndTime":$("#firstEnd").val()
            		}
            	}
            	else if(stime=="subSecond"){
            		subUrl="../AdminServlet/SaveTwo";
            		time={
               			"StartTime":$("#secondStart").val(),
               			"EndTime":$("#secondEnd").val()
               		}
            	}
            	else if(stime=="subFormula"){
            		subUrl="../AdminServlet/SaveThree";
            		time={
               			"StartTime":$("#formulaStart").val(),
               			"EndTime":$("#formulaEnd").val()
               		}
            	}
            	$.ajax({
            		type : "POST",
                    url : subUrl,
                    data: time,
                    success: function(res){
                    	console.log(res);
                    	if(res.flag){
                    		alert("发布成功！");
                    	}
                    	else{
                    		alert("发布失败！");
                    	}
                    },
                    error:function(e){
                    	console.log(e);
                    }
            	})
            })

            $("#pbtn").click(function(){
                window.location.href="../index.html";
            })

            $("#submitBtn").click(function(){
                if($("#newpass").val() != $("#repeatpass").val()){
                    $("#returnMessage").text("重复密码不一致!")
                }
                else{
                    if($("#newpass").val().length<6){
                        $("#returnMessage").text("密码太简单！");
                    }
                    else{
                        var datas = {
                            "number" : oneValues(),
                            "password" : $("#prepass").val(),
                            "newpassword" : $("#newpass").val()
                        }
                        $.ajax({
                            type : "POST",
                            url : "../AdminServlet/updatePwd",
                            data : datas,
                            success : function(res){
                                if(res.flag){
                                    $("#returnMessage").text("修改密码成功！");
                                }
                                else{
                                    $("#returnMessage").text("修改密码失败！");
                                }
                                console.log(res);
                            },
                            error : function(e){
                                console.log(e);
                            }
                        })
                    }      
                }
            })
            
            $("#publishBtn").click(function(){
            	$.ajax({
            		type : "POST",
            		url : "../AdminServlet/changeToOver",
            		success : function(res){
            			console.log(res);
            		},
            		error: function(e){
            			console.log(e);
            		}
            	})
            })

        })
        
    </script>
</body>
</html>